<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-grid/app-grid-style.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/paper-styles/shadow.html">
<link rel="import" href="../bower_components/poly-filter/poly-filter.html">
<link rel="import" href="../bower_components/iron-overlay-behavior/iron-overlay-behavior.html">
<link rel="import" href="../bower_components/iron-overlay-behavior/iron-overlay-backdrop.html">

  <link rel="import" href="elements/plant-info/plant-info.html">


<link rel="import" href="shared-styles.html">

<dom-module id="my-view3">
  <template>   
    <style include="shared-styles app-grid-style">
      :host {
          padding: 10px;
          display: block;
          --app-grid-columns: 5;
          --app-grid-gutter: 10px;
          --app-grid-item-height: 20vw;
        }

        ul {
          padding: 0;
          list-style: none;
        }

        h1 {
          font-family: 'Roboto', 'Noto', sans-serif;
          text-align: center;
          font-size: 18px;
          line-height: 30px;
          font-weight: 400;
          margin: 10px 20px;
        }

        .item {
          list-style: none;
/*          background-color: white;*/
            background-image: url(../images/planten/default.JPG);
        }

        @media (min-width: 800px) {
          .item:nth-child(5n+1) {
            @apply --app-grid-expandible-item;
          }
        }

        @media (max-width: 799px) {
          :host {
            --app-grid-columns: 2;
            --app-grid-gutter: 5px;
            --app-grid-expandible-item-columns: 2;
          }

          .item:nth-child(3n+1) {
            @apply --app-grid-expandible-item;
          }
        }
        
      </style>
       
       <template is="dom-if" if="{{!_plantView()}}">
       
        
        <!-- FETCH ITEMS -->
        <iron-ajax 
            auto
            url="http://localhost:8082/api/planten"
            handle-as="json"
            on-response="handlePlanten" 
            debounce-duration="400"></iron-ajax>
        
        <poly-filter
          array-to-filter="[[plantdata]]"
          filter="[[filterString]]"
          filtered-array="{{filteredPlantData}}">
        </poly-filter>
        
        {{route}}
        
        <span>Filter planten:
          <input type="string" value="{{filterString::input}}" autofocus>
        </span>
        
    <ul class="app-grid">
        <template is="dom-repeat" items="[[filteredPlantData]]" sort="_sort">
          <li class="item">
          <h1>[[item.plantennaam]]</h1>
          
          <!-- FETCH ITEMS -->
<!--
        <iron-ajax 
            auto
            url="https://pixabay.com/api/"                
            params='{"q":"[[item.plantennaam]]", "key": "6487083-266051b7c196ccd9138dd7a80", "image_type": "photo", "lang":"nl", "safesearch":"true","page":"1","per_page":"3"}'            
            handle-as="json"
            last-response="{{plantImg}}"            
            debounce-duration="400"></iron-ajax>
            
            <img src="{{plantImg.hits[0].previewURL}}"/>
-->
            
          </li>
          
        </template>
      </ul>
      
      </template>
         
        
        <template is="dom-if" if="{{_plantView()}}">
        <style>
            h1 {
                font-family: ub
            }
        </style>
        
        <!-- FETCH ITEMS -->
        <iron-ajax 
            auto
            url="http://localhost:8082/api/planten/[[plantId]]"
            handle-as="json"
            last-response="{{plant}}"
            on-error="_plantError"                        
            debounce-duration="400"></iron-ajax>
        
        
            
        <div class="card">
             <template is="dom-if" if="{{plant}}">    
              <ul>
                  <li>[[plant.plantennaam]]</li>
                  <li>[[plant.soort]]</li>
                  <li>[[plant.kleur]]</li>
                  <li>[[plant.prijs]]</li>
                  <li>[[plant.hoogte]]</li>
                  <li>[[plant.id]]</li>
              </ul>
            </template>
            <template is="dom-if" if="{{!plant}}">    
                <h2>Geen plant gevonden</h2>
            </template>
        </div>
        
        
        
                          
      </template>
    
    
  </template>

  <script>
    Polymer({
      is: 'my-view3',
        properties: {                
                plantdata: {
                    type: Array
                },
                plantId: {
                    value: null,
                },
                _showPlant: {
                    type: Boolean,
                    value: false
                }
            },
        /*attached: function() {
            this._updateGridStyles = this._updateGridStyles || function() {
              this.updateStyles();
            }.bind(this);
            window.addEventListener('resize', this._updateGridStyles);
          },

          detached: function() {
            window.removeEventListener('resize', this._updateGridStyles);
          },*/
        handlePlanten: function(data) {
            this.plantdata =data.detail.response
//            var temp = data.detail.response;
//            temp.forEach(function (value) {
//              
//            });
        },
        _sort: function(a, b) {
          var titleA = a.plantennaam.toLowerCase(), titleB = b.plantennaam.toLowerCase();
            if (titleA < titleB)  return -1;
            if (titleA > titleB) return 1;
            return 0;
        },
        ready: function() {
//            console.log('test');
        },
        _plantView: function() {
            this.plantId = this.subroute.path.replace('/','');
            if(this.plantId) {
                return true;
            } else {
                return false;
            }
        },
        _plantError: function(data) {
            this._showPlant = false;
        },
        attributeChanged: function(name, type) {
//            console.log(this.localName + ' attribute ' + name + ' was changed to ' + this.getAttribute(name));
            console.log(name, type);
        },
    });
  </script>
</dom-module>
